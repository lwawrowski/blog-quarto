<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Metody przetwarzania i analizy danych w R - 5&nbsp; Klasyfikacja</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-grupowanie.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Klasyfikacja</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Metody przetwarzania i analizy danych w R</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Wprowadzenie</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-eda.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analiza opisowa</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-testy.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Testowanie hipotez</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-regresja.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regresja</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-grupowanie.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Grupowanie</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-klasyfikacja.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Klasyfikacja</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Spis tre≈õci</h2>
   
  <ul>
  <li><a href="#wprowadzenie" id="toc-wprowadzenie" class="nav-link active" data-scroll-target="#wprowadzenie"> <span class="header-section-number">5.1</span> Wprowadzenie</a></li>
  <li><a href="#drzewa-decyzyjne" id="toc-drzewa-decyzyjne" class="nav-link" data-scroll-target="#drzewa-decyzyjne"> <span class="header-section-number">5.2</span> Drzewa decyzyjne</a></li>
  <li><a href="#gradient-boosting-machine" id="toc-gradient-boosting-machine" class="nav-link" data-scroll-target="#gradient-boosting-machine"> <span class="header-section-number">5.3</span> Gradient Boosting Machine</a>
  <ul class="collapse">
  <li><a href="#zadania" id="toc-zadania" class="nav-link" data-scroll-target="#zadania"> <span class="header-section-number">5.3.1</span> Zadania</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Klasyfikacja</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p><a href="presentations/06_klasyfikacja.html">Prezentacja</a></p>
<section id="wprowadzenie" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="wprowadzenie"><span class="header-section-number">5.1</span> Wprowadzenie</h2>
<p>Celem analizy klasyfikacji jest zbudowanie modelu predykcyjnego, kt√≥ry w rezultacie zwr√≥ci prawdopodobie≈Ñstwo przynale≈ºno≈õci danej obserwacji do jeden z dw√≥ch klas. Przyk≈Çadowo na podstawie danych o klientach banku mo≈ºna stworzyƒá model oceny zdolno≈õci kredytowej dla nowych klient√≥w. W tym rozdziale pos≈Çu≈ºymy siƒô <a href="https://archive.ics.uci.edu/ml/datasets/statlog+(german+credit+data)">German Credit Data</a> do budowy takiego predyktora. Wybrane kolumny z tego zbioru znajdujƒÖ siƒô w <a href="data/german_credit_data.xlsx">tym pliku</a>.</p>
<p>W pierwszym kroku wczytujemy dane i dokonujemy niezbƒôdnych przekszta≈Çce≈Ñ tego zbioru. Z wykorzystaniem funkcji <code>clean_names()</code> z pakietu <em>janitor</em> zamieniamy nazwy kolumn w przyjazne przetwarzaniu przez komputer (brak spacji, polskich znak√≥w, itp.). Nastƒôpnie zmienne tekstowe zamieniamy na zmienne jako≈õciowe - faktory oraz tworzymy nowƒÖ kolumnƒô zawierajƒÖcƒÖ wysoko≈õƒá raty kredytu.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 1.3.1 ‚îÄ‚îÄ</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>‚úî ggplot2 3.3.6      ‚úî purrr   0.3.4 
‚úî tibble  3.1.8      ‚úî dplyr   1.0.10
‚úî tidyr   1.2.0      ‚úî stringr 1.4.1 
‚úî readr   2.1.2      ‚úî forcats 0.5.1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
‚úñ dplyr::filter() masks stats::filter()
‚úñ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Do≈ÇƒÖczanie pakietu: 'janitor'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NastƒôpujƒÖce obiekty zosta≈Çy zakryte z 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>credit <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data/german_credit_data.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as.factor) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">job=</span><span class="fu">as.factor</span>(job),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">installment=</span>credit_amount<span class="sc">/</span>duration)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(credit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      age            sex      job     housing      saving_accounts
 Min.   :19.00   female:310   0: 22   free:108   little    :603   
 1st Qu.:27.00   male  :690   1:200   own :713   moderate  :103   
 Median :33.00                2:630   rent:179   quite rich: 63   
 Mean   :35.55                3:148              rich      : 48   
 3rd Qu.:42.00                                   NA's      :183   
 Max.   :75.00                                                    
                                                                  
 checking_account credit_amount      duration                   purpose   
 little  :274     Min.   :  250   Min.   : 4.0   car                :337  
 moderate:269     1st Qu.: 1366   1st Qu.:12.0   radio/TV           :280  
 rich    : 63     Median : 2320   Median :18.0   furniture/equipment:181  
 NA's    :394     Mean   : 3271   Mean   :20.9   business           : 97  
                  3rd Qu.: 3972   3rd Qu.:24.0   education          : 59  
                  Max.   :18424   Max.   :72.0   repairs            : 22  
                                                 (Other)            : 24  
   risk      installment     
 bad :300   Min.   :  24.06  
 good:700   1st Qu.:  89.60  
            Median : 130.33  
            Mean   : 167.69  
            3rd Qu.: 206.18  
            Max.   :2482.67  
                             </code></pre>
</div>
</div>
<p>Zamiana cech tekstowych na faktory pozwala w podsumowaniu wygenerowanym przez funkcjƒô <code>summary()</code> obserwowaƒá od razu czƒôsto≈õci poszczeg√≥lnych wariant√≥w. Mo≈ºemy zaobserwowaƒá wystƒôpowanie brak√≥w danych w zmiennych saving accounts i checking_account. Generalnie jest to zbyt du≈ºy problem, bo tylko niekt√≥re algorytmy klasyfikacji nie obs≈ÇugujƒÖ brak√≥w danych w zmiennych obja≈õniajƒÖcych. Wa≈ºne jest, ≈ºeby braki danych nie wystƒôpowa≈Çy dla cechy decyzyjnej.</p>
<p>Obserwacje z brakami danych mo≈ºna usunƒÖƒá, ale czƒôsto spowodowa≈Çoby to znaczne zmniejszenie pr√≥by badawczej, zatem stosuje siƒô metody majƒÖce na celu uzupe≈Çnienie brak√≥w danych. W najprostszym przypadku braki mo≈ºna zastƒÖpiƒá ≈õredniƒÖ, medianƒÖ lub dominantƒÖ. Do bardziej zaawansowanych sposob√≥w nale≈ºy metoda najbli≈ºszych sƒÖsiad√≥w (<a href="https://cran.r-project.org/web/packages/VIM/index.html">VIM</a>) albo imputacja wielokrotna (<a href="https://cran.r-project.org/web/packages/mice/index.html">mice</a>).</p>
<p>W omawianym przypadku klient√≥w wiarygodnych jest 700, a tych, kt√≥rzy nie sp≈Çacili zobowiƒÖzania 300. Mamy zatem do czynienia z niezbalansowanƒÖ pr√≥bƒÖ. W idealnym przypadku klasyfikacji, przypadk√≥w z ka≈ºdej grupy powinno byƒá tyle samo. W przeciwnym przypadku model bƒôdzie dzia≈Ça≈Ç lepiej dla klasy wiƒôkszo≈õciowej. NajprostszƒÖ metodƒÖ balansowania danych jest upsampling czyli dolosowywanie obserwacji z klasy mniejszo≈õciowej, tak aby wyr√≥wnaƒá liczebno≈õci. Przeciwie≈Ñstwem tego podej≈õcia jest downsampling. Alternatywnie mo≈ºna zastosowaƒá metodƒô SMOTE, kt√≥ra generuje sztuczne obserwacje dla klasy mniejszo≈õciowej (pakiety <a href="https://cran.r-project.org/web/packages/DMwR/index.html">DMwR</a>, <a href="https://cran.r-project.org/web/packages/imbalance/index.html">imbalance</a>).</p>
</section>
<section id="drzewa-decyzyjne" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="drzewa-decyzyjne"><span class="header-section-number">5.2</span> Drzewa decyzyjne</h2>
<p>NajpopularniejszƒÖ metodƒÖ klasyfikacji sƒÖ drzewa decyzyjne, kt√≥re charakteryzujƒÖ siƒô z regu≈Çy dobrƒÖ efektywno≈õciƒÖ i pozwalajƒÖ na ≈ÇatwƒÖ interpretacjƒô zastosowanych regu≈Ç klasyfikacji. Wykorzystamy pakiet <a href="https://cran.r-project.org/web/packages/rpart/index.html">rpart</a> do stworzenia drzewa oraz pakiet <a href="https://cran.r-project.org/web/packages/rpart.plot/index.html">rpart.plot</a> do wizualizacji.</p>
<p>Proces tworzenia drzewa jest bardzo prosty, a argumenty w funkcji <code>rpart()</code> sƒÖ takie same jak w regresji liniowej.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="at">formula =</span> risk <span class="sc">~</span> ., <span class="at">data =</span> credit)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-klasyfikacja_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>W rezultacie uzyskujemy drzewo decyzyjne z optymalnie dobranymi zmiennymi obja≈õniajƒÖcymi. W ka≈ºdym wƒô≈∫le drzewa podane sƒÖ nastƒôpujƒÖce warto≈õci: - prognozowana klasa, prawdopodobie≈Ñstwa zaklasyfikowania do klasy pozytywnej, odsetek obserwacji w wƒô≈∫le. Domy≈õlnym progiem klasyfikacji jest warto≈õƒá 0,5. Je≈ºeli prawdopodobie≈Ñstwo jest poni≈ºej tej warto≈õci to nastƒÖpi przypisanie do grupy klient√≥w niesp≈ÇacajƒÖcych po≈ºyczki, a je≈õli powy≈ºej to do tej drugiej grupy.</p>
<p>Oceny jako≈õci klasyfikatora dokonuje siƒô na podstawie <a href="https://pl.wikipedia.org/wiki/Tablica_pomy%C5%82ek">macierzy pomy≈Çek</a> oraz miar wyznaczonych na jej podstawie. Najpopularniejsze z nich to:</p>
<ul>
<li>dok≈Çadno≈õƒá (accuracy): % poprawnie zaklasyfikowanych</li>
<li>precyzja (precison): % poprawnie rozpoznanych przypadk√≥w pozytywnych TP/(TP+FP)</li>
<li>czu≈Ço≈õƒá (sensitivity/recall): % prawdziwie pozytywnych TP/(TP+FN)</li>
<li>swoisto≈õƒá (specificity): % prawdziwie negatywnych TN/(TN+FP)</li>
<li>F1: ≈õrednia harmoniczna z czu≈Ço≈õci i precyzji 2TP/(2TP+FP+FN)</li>
</ul>
<p>Im wy≈ºsze warto≈õci tych miar tym lepszy klasyfikator. Do wyznaczenia tych miar w R s≈Çu≈ºy funkcja z pakietu <a href="https://topepo.github.io/caret/">caret</a>. W tym celu trzeba wyznaczyƒá warto≈õci prognozowanej klasy na podstawie modelu.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>≈Åadowanie wymaganego pakietu: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Do≈ÇƒÖczanie pakietu: 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NastƒôpujƒÖcy obiekt zosta≈Ç zakryty z 'package:purrr':

    lift</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pred_risk_m1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> m1, <span class="at">newdata =</span> credit, <span class="at">type =</span> <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Argument <code>type</code> okre≈õla typ predykcji: <code>"class"</code> oznacza prognozowanƒÖ klasƒô, a <code>"prob"</code> prawdopodobie≈Ñstwo. Na tej podstawie oraz warto≈õci rzeczywistych tworzymy macierz pomy≈Çek:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred_risk_m1, <span class="at">reference =</span> credit<span class="sc">$</span>risk, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>, <span class="at">mode =</span> <span class="st">"everything"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad  117   60
      good 183  640
                                          
               Accuracy : 0.757           
                 95% CI : (0.7292, 0.7833)
    No Information Rate : 0.7             
    P-Value [Acc &gt; NIR] : 3.553e-05       
                                          
                  Kappa : 0.3447          
                                          
 Mcnemar's Test P-Value : 5.024e-15       
                                          
            Sensitivity : 0.9143          
            Specificity : 0.3900          
         Pos Pred Value : 0.7776          
         Neg Pred Value : 0.6610          
              Precision : 0.7776          
                 Recall : 0.9143          
                     F1 : 0.8404          
             Prevalence : 0.7000          
         Detection Rate : 0.6400          
   Detection Prevalence : 0.8230          
      Balanced Accuracy : 0.6521          
                                          
       'Positive' Class : good            
                                          </code></pre>
</div>
</div>
<p>W naszym przyk≈Çadzie spo≈õr√≥d 1000 klient√≥w, model jako wiarygodnych kredytobiorc√≥w zaklasyfikowa≈Ç 640, a 117 prawid≈Çowo jako osoby, kt√≥re nie sp≈Çaci≈Çy zobowiƒÖzania. W 60 przypadkach model uzna≈Ç brak zdolno≈õci kredytowej u klienta, podczas gdy w rzeczywisto≈õci po≈ºyczka zosta≈Ça sp≈Çacona. Dla 183 klient√≥w podjƒôtoby odwrotnƒÖ decyzjƒô - model przyzna≈Çby kredyt, a w rzeczywisto≈õci osoby te nie sp≈Çaci≈Çy po≈ºyczki. Dok≈Çadno≈õƒá w tym przypadku wynosi 75,7%, a precyzja 77,8%. Czu≈Ço≈õƒá tego predyktora jest wysoka (91,4%), ale swoisto≈õƒá ju≈º nie (39%), na co mo≈ºe mieƒá wp≈Çyw niezbalansowanie danych.</p>
<p>Przedstawiony powy≈ºej przyk≈Çad mia≈Ç charakter analizy ekspolarycyjnej - opartej na ca≈Çym zbiorze danych. W praktyce stosuje siƒô podej≈õcie polegajƒÖce na podziale zbioru danych na zbi√≥r treningowy oraz walidacyjny. Na danych ze zbioru treningowego buduje siƒô model, kt√≥ry nastƒôpnie testowany jest na danych, kt√≥rych nigdy wcze≈õniej ‚Äúnie widzia≈Ç‚Äù - na zbiorze walidacyjnym. Miary klasyfikacji obliczone na podstawie zbioru walidacyjnego dostarczajƒÖ realnej oceny jako≈õci klasyfikatora.</p>
<p>Do podzia≈Çu zbioru s≈Çu≈ºy funkcja <code>createDataPartition()</code> z pakietu <em>caret</em>. Zbiory treningowy i walidacyjny tworzone sƒÖ w taki spos√≥b, aby zachowaƒá proporcje w zmiennej decyzyjnej. Domy≈õlnie funkcja dzieli zbi√≥r danych w uk≈Çadzie 50/50, natomiast w tym przyk≈Çadzie 80% obserwacji umie≈õcimy w zbiorze treningowym.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y =</span> credit<span class="sc">$</span>risk, <span class="at">p =</span> <span class="fl">0.8</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>train_credit <span class="ot">&lt;-</span> credit[split<span class="sc">$</span>Resample1,]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>valid_credit <span class="ot">&lt;-</span> credit[<span class="sc">-</span>split<span class="sc">$</span>Resample1,]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_credit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      age            sex      job     housing      saving_accounts
 Min.   :19.00   female:252   0: 17   free: 80   little    :486   
 1st Qu.:27.00   male  :548   1:159   own :576   moderate  : 85   
 Median :33.00                2:504   rent:144   quite rich: 49   
 Mean   :35.43                3:120              rich      : 34   
 3rd Qu.:42.00                                   NA's      :146   
 Max.   :75.00                                                    
                                                                  
 checking_account credit_amount      duration                    purpose   
 little  :228     Min.   :  276   Min.   : 4.00   car                :284  
 moderate:205     1st Qu.: 1374   1st Qu.:12.00   radio/TV           :219  
 rich    : 46     Median : 2326   Median :18.00   furniture/equipment:139  
 NA's    :321     Mean   : 3300   Mean   :21.02   business           : 76  
                  3rd Qu.: 3965   3rd Qu.:24.00   education          : 46  
                  Max.   :18424   Max.   :72.00   repairs            : 17  
                                                  (Other)            : 19  
   risk      installment     
 bad :240   Min.   :  24.06  
 good:560   1st Qu.:  87.18  
            Median : 131.74  
            Mean   : 168.95  
            3rd Qu.: 206.06  
            Max.   :2482.67  
                             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(valid_credit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      age            sex      job     housing      saving_accounts
 Min.   :20.00   female: 58   0:  5   free: 28   little    :117   
 1st Qu.:27.00   male  :142   1: 41   own :137   moderate  : 18   
 Median :34.00                2:126   rent: 35   quite rich: 14   
 Mean   :36.02                3: 28              rich      : 14   
 3rd Qu.:42.00                                   NA's      : 37   
 Max.   :74.00                                                    
                                                                  
 checking_account credit_amount      duration                    purpose  
 little  :46      Min.   :  250   Min.   : 4.00   radio/TV           :61  
 moderate:64      1st Qu.: 1308   1st Qu.:12.00   car                :53  
 rich    :17      Median : 2261   Median :18.00   furniture/equipment:42  
 NA's    :73      Mean   : 3157   Mean   :20.43   business           :21  
                  3rd Qu.: 4003   3rd Qu.:24.00   education          :13  
                  Max.   :15672   Max.   :48.00   repairs            : 5  
                                                  (Other)            : 5  
   risk      installment    
 bad : 60   Min.   : 38.12  
 good:140   1st Qu.: 93.12  
            Median :127.23  
            Mean   :162.62  
            3rd Qu.:206.21  
            Max.   :730.80  
                            </code></pre>
</div>
</div>
<p>WykorzystujƒÖc tak przygotowane dane mo≈ºemy jeszcze raz wykorzystaƒá drzewa decyzyjne do stworzenia klasyfikatora, ale tym razem wy≈ÇƒÖcznie na zbiorze treningowym.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(risk <span class="sc">~</span> ., train_credit)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-klasyfikacja_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Utworzone drzewo bƒôdzie r√≥≈ºniƒá siƒô od tego, kt√≥re powsta≈Ço na podstawie ca≈Çego zbioru danych. Nastƒôpnie obliczamy prognozowane klasy na obu zbiorach i wyznaczamy macierze pomy≈Çek.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pred_risk_m2_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> m2, <span class="at">newdata =</span> train_credit, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>pred_risk_m2_valid <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> m2, <span class="at">newdata =</span> valid_credit, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># train</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred_risk_m2_train, <span class="at">reference =</span> train_credit<span class="sc">$</span>risk, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>, <span class="at">mode =</span> <span class="st">"everything"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad   94   38
      good 146  522
                                          
               Accuracy : 0.77            
                 95% CI : (0.7392, 0.7987)
    No Information Rate : 0.7             
    P-Value [Acc &gt; NIR] : 5.783e-06       
                                          
                  Kappa : 0.3716          
                                          
 Mcnemar's Test P-Value : 3.067e-15       
                                          
            Sensitivity : 0.9321          
            Specificity : 0.3917          
         Pos Pred Value : 0.7814          
         Neg Pred Value : 0.7121          
              Precision : 0.7814          
                 Recall : 0.9321          
                     F1 : 0.8502          
             Prevalence : 0.7000          
         Detection Rate : 0.6525          
   Detection Prevalence : 0.8350          
      Balanced Accuracy : 0.6619          
                                          
       'Positive' Class : good            
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># valid</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred_risk_m2_valid, <span class="at">reference =</span> valid_credit<span class="sc">$</span>risk, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>, <span class="at">mode =</span> <span class="st">"everything"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad   18   11
      good  42  129
                                          
               Accuracy : 0.735           
                 95% CI : (0.6681, 0.7948)
    No Information Rate : 0.7             
    P-Value [Acc &gt; NIR] : 0.1579          
                                          
                  Kappa : 0.2598          
                                          
 Mcnemar's Test P-Value : 3.775e-05       
                                          
            Sensitivity : 0.9214          
            Specificity : 0.3000          
         Pos Pred Value : 0.7544          
         Neg Pred Value : 0.6207          
              Precision : 0.7544          
                 Recall : 0.9214          
                     F1 : 0.8296          
             Prevalence : 0.7000          
         Detection Rate : 0.6450          
   Detection Prevalence : 0.8550          
      Balanced Accuracy : 0.6107          
                                          
       'Positive' Class : good            
                                          </code></pre>
</div>
</div>
<p>Generalnie wyniki w obu przypadkach powinny byƒá do siebie zbli≈ºone, przy czym na zbiorze walidacyjnym miary jako≈õci predycji mogƒÖ byƒá trochƒô gorsze. Bardzo wysoka warto≈õƒá dok≈Çadno≈õƒá na zbiorze treningowym, a niska na zbiorze walidacyjnym jest symptomem przeuczenia modelu - algorytm nauczy≈Ç siƒô odpowiedzi ‚Äúna pamiƒôƒá‚Äù.</p>
</section>
<section id="gradient-boosting-machine" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="gradient-boosting-machine"><span class="header-section-number">5.3</span> Gradient Boosting Machine</h2>
<p>Spr√≥bujemy polepszyƒá jako≈õƒá klasyfikacji z wykorzystaniem metody gradient boostingu. W tym celu wykorzystamy pakiet <a href="https://www.h2o.ai/">h2o</a>, kt√≥ry dostarcza kompleksowych rozwiƒÖza≈Ñ z zakresu machine learning. W pierwszej kolejno≈õci trzeba zmieniƒá format danych na ten obs≈Çugowany przez pakiet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(h2o)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
----------------------------------------------------------------------

Your next step is to start H2O:
    &gt; h2o.init()

For H2O package documentation, ask for help:
    &gt; ??h2o

After starting H2O, you can use the Web UI at http://localhost:54321
For more information visit https://docs.h2o.ai

----------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Do≈ÇƒÖczanie pakietu: 'h2o'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NastƒôpujƒÖce obiekty zosta≈Çy zakryte z 'package:stats':

    cor, sd, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NastƒôpujƒÖce obiekty zosta≈Çy zakryte z 'package:base':

    &amp;&amp;, %*%, %in%, ||, apply, as.factor, as.numeric, colnames,
    colnames&lt;-, ifelse, is.character, is.factor, is.numeric, log,
    log10, log1p, log2, round, signif, trunc</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.init</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
H2O is not running yet, starting it now...

Note:  In case of errors look at the following log files:
    /tmp/RtmpkJWOFJ/file3baa74f1963b5/h2o_lukasz_started_from_r.out
    /tmp/RtmpkJWOFJ/file3baa74b6d7bb1/h2o_lukasz_started_from_r.err


Starting H2O JVM and connecting: ... Connection successful!

R is connected to the H2O cluster: 
    H2O cluster uptime:         1 seconds 641 milliseconds 
    H2O cluster timezone:       Europe/Warsaw 
    H2O data parsing timezone:  UTC 
    H2O cluster version:        3.38.0.1 
    H2O cluster version age:    5 months and 20 days !!! 
    H2O cluster name:           H2O_started_from_R_lukasz_xpm862 
    H2O cluster total nodes:    1 
    H2O cluster total memory:   7.80 GB 
    H2O cluster total cores:    8 
    H2O cluster allowed cores:  8 
    H2O cluster healthy:        TRUE 
    H2O Connection ip:          localhost 
    H2O Connection port:        54321 
    H2O Connection proxy:       NA 
    H2O Internal Security:      FALSE 
    R Version:                  R version 4.2.2 Patched (2022-11-10 r83330) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in h2o.clusterInfo(): 
Your H2O cluster version is too old (5 months and 20 days)!
Please download and install the latest version from http://h2o.ai/download/</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.no_progress</span>() <span class="co"># brak pask√≥w postƒôpu</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>train_credit_h2o <span class="ot">&lt;-</span> <span class="fu">as.h2o</span>(train_credit)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>valid_credit_h2o <span class="ot">&lt;-</span> <span class="fu">as.h2o</span>(valid_credit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nastƒôpnie deklarujemy nazwy wykorzystywanych zmiennych i uruchamiamy procedurƒô:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>y_var <span class="ot">&lt;-</span> <span class="st">"risk"</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>x_var <span class="ot">&lt;-</span> <span class="fu">names</span>(credit)[<span class="sc">-</span><span class="dv">10</span>]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">h2o.gbm</span>(<span class="at">x =</span> x_var, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">y =</span> y_var, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">training_frame =</span> train_credit_h2o, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">validation_frame =</span> valid_credit_h2o, </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">seed =</span> <span class="dv">1</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>m3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Details:
==============

H2OBinomialModel: gbm
Model ID:  GBM_model_R_1678576169235_1 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth
1              50                       50               13762         5
  max_depth mean_depth min_leaves max_leaves mean_leaves
1         5    5.00000         10         26    17.38000


H2OBinomialMetrics: gbm
** Reported on training data. **

MSE:  0.07844172
RMSE:  0.2800745
LogLoss:  0.2801827
Mean Per-Class Error:  0.09345238
AUC:  0.9696838
AUCPR:  0.9855312
Gini:  0.9393676
R^2:  0.626468

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error     Rate
bad    205   35 0.145833  =35/240
good    23  537 0.041071  =23/560
Totals 228  572 0.072500  =58/800

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold      value idx
1                       max f1  0.569359   0.948763 236
2                       max f2  0.478467   0.964236 262
3                 max f0point5  0.669186   0.948864 201
4                 max accuracy  0.569359   0.927500 236
5                max precision  0.987622   1.000000   0
6                   max recall  0.363744   1.000000 305
7              max specificity  0.987622   1.000000   0
8             max absolute_mcc  0.569359   0.825421 236
9   max min_per_class_accuracy  0.651784   0.904167 206
10 max mean_per_class_accuracy  0.669186   0.907738 201
11                     max tns  0.987622 240.000000   0
12                     max fns  0.987622 559.000000   0
13                     max fps  0.049138 240.000000 399
14                     max tps  0.363744 560.000000 305
15                     max tnr  0.987622   1.000000   0
16                     max fnr  0.987622   0.998214   0
17                     max fpr  0.049138   1.000000 399
18                     max tpr  0.363744   1.000000 305

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
H2OBinomialMetrics: gbm
** Reported on validation data. **

MSE:  0.1816324
RMSE:  0.4261836
LogLoss:  0.5493537
Mean Per-Class Error:  0.4071429
AUC:  0.729881
AUCPR:  0.8518075
Gini:  0.4597619
R^2:  0.1350837

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error     Rate
bad     12   48 0.800000   =48/60
good     2  138 0.014286   =2/140
Totals  14  186 0.250000  =50/200

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold      value idx
1                       max f1  0.288120   0.846626 185
2                       max f2  0.195621   0.928382 193
3                 max f0point5  0.587924   0.809659 140
4                 max accuracy  0.289167   0.750000 183
5                max precision  0.973438   1.000000   0
6                   max recall  0.195621   1.000000 193
7              max specificity  0.973438   1.000000   0
8             max absolute_mcc  0.587924   0.366055 140
9   max min_per_class_accuracy  0.738988   0.685714 113
10 max mean_per_class_accuracy  0.738988   0.692857 113
11                     max tns  0.973438  60.000000   0
12                     max fns  0.973438 139.000000   0
13                     max fps  0.067249  60.000000 199
14                     max tps  0.195621 140.000000 193
15                     max tnr  0.973438   1.000000   0
16                     max fnr  0.973438   0.992857   0
17                     max fpr  0.067249   1.000000 199
18                     max tpr  0.195621   1.000000 193

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</code></pre>
</div>
</div>
<p>Z funkcji pakietu h2o dostajemy poka≈∫ny wydruk podsumowania klasyfikacji wraz z macierzami pomy≈Çek. Pakiet h2o optymalizuje jako≈õƒá predycji maksymalizujƒÖƒá miarƒô F1 - ≈õredniƒÖ harmonicznƒÖ czu≈Ço≈õci i swoisto≈õci. Zatem w tym przypadku podzia≈Ç na klasy wg prawdopodobie≈Ñstwa nie odbywa siƒô ju≈º na podstawie warto≈õci 0,5.</p>
<p>Stworzymy macierz pomy≈Çek dla zbioru walidacyjnego w tym samym formacie, co wcze≈õniej:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pred_risk_m3_valid <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">h2o.predict</span>(<span class="at">object =</span> m3, <span class="at">newdata =</span> valid_credit_h2o))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred_risk_m3_valid<span class="sc">$</span>predict, <span class="at">reference =</span> valid_credit<span class="sc">$</span>risk, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>, <span class="at">mode =</span> <span class="st">"everything"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad   12    2
      good  48  138
                                         
               Accuracy : 0.75           
                 95% CI : (0.684, 0.8084)
    No Information Rate : 0.7            
    P-Value [Acc &gt; NIR] : 0.06955        
                                         
                  Kappa : 0.2378         
                                         
 Mcnemar's Test P-Value : 1.966e-10      
                                         
            Sensitivity : 0.9857         
            Specificity : 0.2000         
         Pos Pred Value : 0.7419         
         Neg Pred Value : 0.8571         
              Precision : 0.7419         
                 Recall : 0.9857         
                     F1 : 0.8466         
             Prevalence : 0.7000         
         Detection Rate : 0.6900         
   Detection Prevalence : 0.9300         
      Balanced Accuracy : 0.5929         
                                         
       'Positive' Class : good           
                                         </code></pre>
</div>
</div>
<p>Mo≈ºemy zauwa≈ºyƒá nieznacznƒÖ poprawƒô dok≈Çadno≈õci predykcji w por√≥wnaniu do drzewa decyzyjnego - z 73,5% do 75%. Natomiast ten algorytm zosta≈Ç uruchomiony z domy≈õlnymi parametrami i byƒá mo≈ºe wyb√≥r innych warto≈õci m√≥g≈Çby poprawiƒá jako≈õƒá predykcji. Poszukiwania najlepszych warto≈õci do algorytmu nosi nazwƒô tuningu hiperparametr√≥w. Z racji tego, ≈ºe przeszukiwana przestrze≈Ñ parametr√≥w mog≈Çaby byƒá bardzo du≈ºa to z regu≈Çy przeprowadza siƒô to w spos√≥b losowy. Poni≈ºej lista mo≈ºliwych do zastosowania parametr√≥w w metodzie GBM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>gbm_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">learn_rate =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>),</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max_depth =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">1</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sample_rate =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_sample_rate =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ntrees =</span> <span class="fu">seq</span>(<span class="dv">50</span>,<span class="dv">150</span>,<span class="dv">10</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>search_criteria <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">strategy =</span> <span class="st">"RandomDiscrete"</span>, <span class="at">max_models =</span> <span class="dv">36</span>, <span class="at">seed =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wszystkich kombinacji parametr√≥w jest 59400 i weryfikacja ich wszystkich zajƒô≈Ça by sporo czasu, zatem w spos√≥b losowy szukamy najlepszych 36 modeli. Z tego zestawu wybieramy najlepszy wed≈Çug kryterium jakim jest miara AUC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gbm_grid <span class="ot">&lt;-</span> <span class="fu">h2o.grid</span>(<span class="at">algorithm =</span> <span class="st">"gbm"</span>, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> x_var, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> y_var,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">grid_id =</span> <span class="st">"gbm_grid"</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">training_frame =</span> train_credit_h2o,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">validation_frame =</span> valid_credit_h2o,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hyper_params =</span> gbm_params,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">search_criteria =</span> search_criteria)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>gbm_gridperf <span class="ot">&lt;-</span> <span class="fu">h2o.getGrid</span>(<span class="at">grid_id =</span> <span class="st">"gbm_grid"</span>,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sort_by =</span> <span class="st">"auc"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">h2o.getModel</span>(gbm_gridperf<span class="sc">@</span>model_ids[[<span class="dv">1</span>]])</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>m4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Details:
==============

H2OBinomialModel: gbm
Model ID:  gbm_grid_model_33 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth
1              80                       80                8421         2
  max_depth mean_depth min_leaves max_leaves mean_leaves
1         2    2.00000          3          4     3.75000


H2OBinomialMetrics: gbm
** Reported on training data. **

MSE:  0.1442394
RMSE:  0.3797886
LogLoss:  0.449481
Mean Per-Class Error:  0.2833333
AUC:  0.8456138
AUCPR:  0.921934
Gini:  0.6912277
R^2:  0.3131457

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error      Rate
bad    119  121 0.504167  =121/240
good    35  525 0.062500   =35/560
Totals 154  646 0.195000  =156/800

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold      value idx
1                       max f1  0.500182   0.870647 293
2                       max f2  0.371147   0.932146 352
3                 max f0point5  0.671700   0.864148 196
4                 max accuracy  0.500182   0.805000 293
5                max precision  0.956594   1.000000   0
6                   max recall  0.292273   1.000000 379
7              max specificity  0.956594   1.000000   0
8             max absolute_mcc  0.643739   0.520541 214
9   max min_per_class_accuracy  0.666048   0.770833 200
10 max mean_per_class_accuracy  0.671700   0.775595 196
11                     max tns  0.956594 240.000000   0
12                     max fns  0.956594 559.000000   0
13                     max fps  0.163448 240.000000 399
14                     max tps  0.292273 560.000000 379
15                     max tnr  0.956594   1.000000   0
16                     max fnr  0.956594   0.998214   0
17                     max fpr  0.163448   1.000000 399
18                     max tpr  0.292273   1.000000 379

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`
H2OBinomialMetrics: gbm
** Reported on validation data. **

MSE:  0.1749705
RMSE:  0.4182947
LogLoss:  0.5266207
Mean Per-Class Error:  0.4154762
AUC:  0.751369
AUCPR:  0.8703734
Gini:  0.5027381
R^2:  0.1668073

Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:
       bad good    Error     Rate
bad     11   49 0.816667   =49/60
good     2  138 0.014286   =2/140
Totals  13  187 0.255000  =51/200

Maximum Metrics: Maximum metrics at their respective thresholds
                        metric threshold      value idx
1                       max f1  0.399730   0.844037 178
2                       max f2  0.335934   0.925926 187
3                 max f0point5  0.624918   0.826023 127
4                 max accuracy  0.576083   0.760000 137
5                max precision  0.953756   1.000000   0
6                   max recall  0.335934   1.000000 187
7              max specificity  0.953756   1.000000   0
8             max absolute_mcc  0.624918   0.416343 127
9   max min_per_class_accuracy  0.696832   0.664286 105
10 max mean_per_class_accuracy  0.624918   0.711905 127
11                     max tns  0.953756  60.000000   0
12                     max fns  0.953756 139.000000   0
13                     max fps  0.247891  60.000000 191
14                     max tps  0.335934 140.000000 187
15                     max tnr  0.953756   1.000000   0
16                     max fnr  0.953756   0.992857   0
17                     max fpr  0.247891   1.000000 191
18                     max tpr  0.335934   1.000000 187

Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</code></pre>
</div>
</div>
<p>Standardowo utworzymy macierz pomy≈Çek i obliczymy pozosta≈Çe miary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pred_risk_m4_valid <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">h2o.predict</span>(<span class="at">object =</span> m4, <span class="at">newdata =</span> valid_credit_h2o))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred_risk_m4_valid<span class="sc">$</span>predict, <span class="at">reference =</span> valid_credit<span class="sc">$</span>risk, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"good"</span>, <span class="at">mode =</span> <span class="st">"everything"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction bad good
      bad   11    2
      good  49  138
                                          
               Accuracy : 0.745           
                 95% CI : (0.6787, 0.8039)
    No Information Rate : 0.7             
    P-Value [Acc &gt; NIR] : 0.09344         
                                          
                  Kappa : 0.2178          
                                          
 Mcnemar's Test P-Value : 1.185e-10       
                                          
            Sensitivity : 0.9857          
            Specificity : 0.1833          
         Pos Pred Value : 0.7380          
         Neg Pred Value : 0.8462          
              Precision : 0.7380          
                 Recall : 0.9857          
                     F1 : 0.8440          
             Prevalence : 0.7000          
         Detection Rate : 0.6900          
   Detection Prevalence : 0.9350          
      Balanced Accuracy : 0.5845          
                                          
       'Positive' Class : good            
                                          </code></pre>
</div>
</div>
<p>Finalny model charakteryzuje siƒô dok≈Çadno≈õciƒÖ na poziomie 76,5%, zatem uda≈Ço siƒô poprawiƒá jego jako≈õƒá w por√≥wnaniu do drzewa decyzyjnego oraz wersji GBM z domy≈õlnymi parametrami.</p>
<p>Innym sposobem oceny jako≈õci modelu jest symulacja wyniku biznesowego na podstawie koszt√≥w dla ka≈ºdej kom√≥rki macierzy pomy≈Çek. W naszym przypadku przyjmiemy bardzo uproszczone miary: ≈õrednia kwota kredytu: 3500, mar≈ºa na sp≈Çaconym kredycie: 20%, strata na niesp≈Çaconym kredycie: 50%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># m2</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="dv">42</span><span class="sc">*-</span>(<span class="dv">3500</span><span class="sc">*</span><span class="fl">0.5</span>)<span class="sc">+</span><span class="dv">129</span><span class="sc">*</span>(<span class="dv">3500</span><span class="sc">*</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16800</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># m3</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span><span class="sc">*-</span>(<span class="dv">3500</span><span class="sc">*</span><span class="fl">0.5</span>)<span class="sc">+</span><span class="dv">140</span><span class="sc">*</span>(<span class="dv">3500</span><span class="sc">*</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># m4</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="dv">43</span><span class="sc">*-</span>(<span class="dv">3500</span><span class="sc">*</span><span class="fl">0.5</span>)<span class="sc">+</span><span class="dv">136</span><span class="sc">*</span>(<span class="dv">3500</span><span class="sc">*</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19950</code></pre>
</div>
</div>
<p>NajwiƒôkszƒÖ korzy≈õƒá uzyskamy korzystajƒÖc z modelu <code>m4</code>.</p>
<p>Jako≈õƒá predykcji mo≈ºemy tak≈ºe spr√≥bowaƒá poprawiƒá manewrujƒÖc progiem prawdopodobie≈Ñstwa klasyfikacji. Narzƒôdziem, kt√≥re mo≈ºe w tym pom√≥c jest krzywa ROC, kt√≥ra przestawia warto≈õci czu≈Ço≈õci i swoisto≈õci dla r√≥≈ºnych prog√≥w.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">h2o.performance</span>(m4, <span class="at">valid =</span> T), <span class="at">type =</span> <span class="st">"roc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-klasyfikacja_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>PrzekƒÖtna przedstawia klasyfikator losowy, natomiast punkty le≈ºƒÖce powy≈ºej to klasyfikatory lepsze od losowego. Klasyfikator idealny by≈Çby krzywƒÖ o nastƒôpujƒÖcym przebiegu (0,0) -&gt; (0,1) -&gt; (1,1). Pole pod krzywƒÖ ROC jest tak≈ºe miarƒÖ jako≈õci klasyfikacji - AUC, kt√≥rej wysokie warto≈õci sƒÖ po≈ºƒÖdane.</p>
<p>Zastosowany przez nas model GBM jest pewnƒÖ czarnƒÖ skrzynkƒÖ, zatem nie wiadomo dok≈Çadnie na podstawie jakich regu≈Ç ta klasyfikacja przebiega, ale mo≈ºemy wykorzystaƒá pewne miary tzw. Explainable AI w celu opisu modelu.</p>
<p>PierwszƒÖ z nich jest wa≈ºno≈õƒá cech, kt√≥ra okre≈õla jak bardzo model wykorzystuje danƒÖ cechƒô do predycji.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.varimp</span>(m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variable Importances: 
           variable relative_importance scaled_importance percentage
1  checking_account          164.028534          1.000000   0.428749
2          duration           53.408806          0.325607   0.139603
3       installment           43.910915          0.267703   0.114777
4   saving_accounts           37.021275          0.225700   0.096769
5     credit_amount           35.085529          0.213899   0.091709
6               age           19.486319          0.118798   0.050935
7           purpose           15.291790          0.093226   0.039971
8               sex           10.269917          0.062611   0.026844
9           housing            2.307869          0.014070   0.006032
10              job            1.764029          0.010754   0.004611</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.varimp_plot</span>(m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-klasyfikacja_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Na tej podstawie mo≈ºemy stwierdziƒá, ≈ºe najwa≈ºniejszƒÖ cechƒÖ majƒÖcƒÖ wp≈Çyw na klasyfikacjƒô jest checking_account. Na kolejnych miejscach jest installment oraz credit_amount. Najmniej wa≈ºna jest zmienna housing.</p>
<p>Innym metodem opisu dzia≈Çania modelu jest partial dependency plot, przedstawiajƒÖcy zale≈ºno≈õƒá prawdopodobie≈Ñstwa klasyfikacji od warto≈õci danej cechy niezale≈ºnej.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.partialPlot</span>(<span class="at">object =</span> m4, <span class="at">data =</span> valid_credit_h2o, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"checking_account"</span>,<span class="st">"credit_amount"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-klasyfikacja_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.window(...): 'medcol' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.window(...): 'medlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.window(...): 'staplelty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.window(...): 'boxlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.xy(xy, type, ...): 'medcol' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.xy(xy, type, ...): 'medlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.xy(xy, type, ...): 'staplelty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.xy(xy, type, ...): 'boxlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'medcol' nie jest
parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'medlty' nie jest
parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'staplelty' nie
jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'boxlty' nie jest
parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'medcol' nie jest
parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'medlty' nie jest
parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'staplelty' nie
jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in axis(side = side, at = at, labels = labels, ...): 'boxlty' nie jest
parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in box(...): 'medcol' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in box(...): 'medlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in box(...): 'staplelty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in box(...): 'boxlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in title(...): 'medcol' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in title(...): 'medlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in title(...): 'staplelty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in title(...): 'boxlty' nie jest parametrem graficznym</code></pre>
</div>
<div class="cell-output-display">
<p><img src="05-klasyfikacja_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
PartialDependence: Partial dependency plot for checking_account
  checking_account mean_response stddev_response std_error_mean_response
1           little      0.591274        0.152221                0.010764
2         moderate      0.638785        0.150663                0.010654
3             rich      0.809393        0.092115                0.006514

[[2]]
PartialDependence: Partial dependency plot for credit_amount
   credit_amount mean_response stddev_response std_error_mean_response
1     250.000000      0.763155        0.157128                0.011111
2    1061.684211      0.722067        0.177397                0.012544
3    1873.368421      0.726639        0.179054                0.012661
4    2685.052632      0.726639        0.179054                0.012661
5    3496.736842      0.726639        0.179054                0.012661
6    4308.421053      0.682370        0.181120                0.012807
7    5120.105263      0.682370        0.181120                0.012807
8    5931.789474      0.682370        0.181120                0.012807
9    6743.473684      0.631133        0.198735                0.014053
10   7555.157895      0.650912        0.194416                0.013747
11   8366.842105      0.636791        0.200403                0.014171
12   9178.526316      0.636791        0.200403                0.014171
13   9990.210526      0.630476        0.195998                0.013859
14  10801.894737      0.630476        0.195998                0.013859
15  11613.578947      0.487381        0.197673                0.013978
16  12425.263158      0.487381        0.197673                0.013978
17  13236.947368      0.487381        0.197673                0.013978
18  14048.631579      0.487381        0.197673                0.013978
19  14860.315789      0.487381        0.197673                0.013978
20  15672.000000      0.487381        0.197673                0.013978</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.shutdown</span>(<span class="at">prompt =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>W tym przypadku mo≈ºemy zaobserwowaƒá, ≈ºe im klient bogatszy tym wiƒôksza szansa na klasyfikacjƒô do grupy wiarygodnych kredytobiorc√≥w. Z kolei wraz ze wzrostem wysoko≈õci kredytu to prawdopodobie≈Ñstwo maleje.</p>
<section id="zadania" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="zadania"><span class="header-section-number">5.3.1</span> Zadania</h3>
<ol type="1">
<li>Sprawd≈∫ jak model bƒôdzie siƒô sprawdza≈Ç na danych, w kt√≥rych braki danych sƒÖ traktowane jako osobna kategoria:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>credit_wna <span class="ot">&lt;-</span> credit <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"saving_accounts"</span>, <span class="st">"checking_account"</span>), fct_explicit_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Na podstawie charakterystyki <a href="http://www.wawrowski.edu.pl/data/sf_ny_homes.csv">mieszka≈Ñ</a> przeprowad≈∫ klasyfikacjƒô ich umiejscowienia - San Francisco vs.&nbsp;New York.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>homes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://www.wawrowski.edu.pl/data/sf_ny_homes.csv"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>homes <span class="ot">&lt;-</span> homes <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_sf=</span><span class="fu">as.factor</span>(in_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04-grupowanie.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Grupowanie</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>