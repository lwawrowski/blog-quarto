{
  "hash": "f5375cc564be5c6ff7cd8831039f97bd",
  "result": {
    "markdown": "---\ntitle: \"Smog w Pszczynie a kierunek i siła wiatru\"\ndescription: \"W poszukiwaniu związku pomiędzy stężeniem PM10 a wiatrem w Pszczynie.\"\nauthor: \"Łukasz Wawrowski\"\ndate: \"02-18-2020\"\nimage: \"smog-wiatr_files/figure-html/unnamed-chunk-9-1.png\"\n---\n\n\n\n\nIstotnym czynnikiem mającym wpływ na jakość powietrza jest także siła i kierunek wiatru. Instytut Meteorologii i Gospodarki Wodnej gromadzi takie dane w odstępach 10 minutowych i można je pobrać z [tej strony](https://dane.imgw.pl/datastore) dla wszystkich stacji. Dane archiwalne są w plikach .zip dla każdego miesiąca osobno. Pobrałem ręcznie 60 plików i je rozpakowałem, a następnie wczytałem je do R za pomocą poniższego skryptu. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\n\nwczytaj_pliki <- function(nazwa){\n  \n  d <- read_csv2(str_c(\"wiatr/\",nazwa), col_names = F) %>% \n    filter(X1==249180010) # stacja w Pszczynie\n  \n  return(d)\n}\n\n# kierunek wiatru\n\npliki_wiatr_kierunek <- str_c(sort(rep(str_c(\"B00202A_\",2015:2019),12)),\n                              \"_\",sprintf(\"%02d\",1:12),\".csv\")\n\nwiatr_kierunek <- map_df(pliki_wiatr_kierunek, wczytaj_pliki)\n\nwiatr_kierunek <- wiatr_kierunek %>% \n  select(data_time=X3, kierunek=X4) %>% \n  mutate(data=as_date(data_time),\n         kierunek8=cut(x=kierunek, breaks = seq(from = 0, to = 360, by = 22.5), \n                       labels = c(\"N\", \"NE\", \"NE\", \"E\", \"E\", \"SE\", \"SE\", \"S\", \n                                  \"S\", \"SW\", \"SW\", \"W\", \"W\", \"NW\", \"NW\", \"N\")))\n\n# siła wiatru\n\npliki_wiatr_sila <- str_c(sort(rep(str_c(\"B00702A_\",2015:2019),12)),\n                          \"_\",sprintf(\"%02d\",1:12),\".csv\")\n\nwiatr_sila <- map_df(pliki_wiatr_sila, wczytaj_pliki)\n\nwiatr_sila <- wiatr_sila %>% \n  select(data_time=X3, sila=X4)\n\nwiatr_kierunek_sila <- inner_join(wiatr_kierunek, wiatr_sila, by = \"data_time\")\n```\n:::\n\n\nWynikowy zbiór danych zawiera 257484 obserwacji i 5 kolumn. Kierunek wiatru jest określany na planie koła w zakresie o 0° do 360°. Dobrze to obrazuje poniższy obrazek.\n\n![](wind.png)\n\nNa potrzeby analizy podzieliłem koło na 8 części po 45°, aby wyodrębnić najważniejsze kierunki wiatru.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwiatr_kierunek_sila %>% \n  count(kierunek8) %>% \n  mutate(kierunek8=fct_reorder(kierunek8, n)) %>% \n  ggplot(aes(x=kierunek8, y=n)) +\n  geom_col(fill = \"#6daaee\") +\n  coord_flip() +\n  ylim(0,80000) +\n  xlab(\"Kierunek wiatru\") +\n  ylab(\"Liczba pomiarów\") +\n  ggtitle(\"Liczba pomiarów kierunku wiatru - dane 10-minutowe\") +\n  labs(caption = \"Łukasz Wawrowski - wawrowski.edu.pl\") +\n  theme_light() +\n  theme(plot.caption = element_text(color = \"grey80\"))\n```\n\n::: {.cell-output-display}\n![](smog-wiatr_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nW Pszczynie wiatr najczęściej wieje z południowego-zachodu (SW). Na drugim i trzecim miejscu z podobnym rezultatem jest wiatr zachodni (W) i wschodni (E). Najrzadziej doświadczany jest wiatr północny.\n\nNa potrzeby analizy smogu dane dotyczące wiatru musiały zostać zagregowane do danych dziennych. W tym celu obliczyłem liczbę pomiarów kierunku wiatru każdego dnia i dla każdego dnia wybrałem ten dominujący. Jeśli jakiegoś dnia dwa kierunki występowały tyle samo razy to wybierałem ten, który wiał silniej w odniesieniu do mediany.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwiatr_kierunek_sila_dzien <- wiatr_kierunek_sila %>% \n  group_by(data,kierunek8) %>% \n  summarise(n=n(),\n            sila_med=median(sila)) %>% \n  group_by(data) %>% \n  top_n(1,n) %>% \n  top_n(1,sila_med) %>% \n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'data'. You can override using the\n`.groups` argument.\n```\n:::\n:::\n\n\nRezultatem jest zbiór zawierający 1815 obserwacji. Sprawdźmy czy zmienił się rozkład występowania kierunku wiatru.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwiatr_kierunek_sila_dzien %>% \n  count(kierunek8) %>% \n  mutate(kierunek8=fct_reorder(kierunek8, n)) %>% \n  ggplot(aes(x=kierunek8, y=n)) +\n  geom_col(fill = \"#6daaee\") +\n  coord_flip() +\n  xlab(\"Kierunek wiatru\") +\n  ylab(\"Liczba pomiarów\") +\n  ggtitle(\"Liczba pomiarów kierunku wiatru - dane dzienne\") +\n  labs(caption = \"Łukasz Wawrowski - wawrowski.edu.pl\") +\n  theme_light() +\n  theme(plot.caption = element_text(color = \"grey80\"))\n```\n\n::: {.cell-output-display}\n![](smog-wiatr_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nNadal dominuje wiatr południowo-zachodni, natomiast nastąpiła zamiana na drugim i trzecim miejscu - wiatru zachodniego ze wschodnim. Także na ostatnich dwóch pozycjach kategorie są odwrotnie w porównaniu do pomiarów co 10 minut.\n\nZobaczmy jak analizowane zjawisko kształtowało się w czasie.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(wiatr_kierunek_sila_dzien, aes(x=data, y=sila_med, color=kierunek8)) +\n  geom_point() +\n  scale_color_discrete(name = \"Kierunek wiatru\") +\n  xlab(\"Data\") +\n  ylab(\"Mediana siły wiatru (w m/s)\") +\n  ggtitle(\"Siła i kierunek wiatru w latach 2015-2019\") +\n  labs(caption = \"Łukasz Wawrowski - wawrowski.edu.pl\") +\n  theme_light() +\n  theme(legend.position = \"bottom\",\n        plot.caption = element_text(color = \"grey80\")) +\n  guides(col = guide_legend(nrow = 1))\n```\n\n::: {.cell-output-display}\n![](smog-wiatr_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nMożna zauważyć, że zimą wiatr wieje silniej niż w pozostałej części roku. Wśród wysokich wartości dominuje kierunek południowo-zachodni i zachodni. \n\nW następnej kolejności zestawimy te dane ze stężeniem pyłów PM10.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm10_wiatr <- inner_join(pm10_pszczyna, wiatr_kierunek_sila_dzien, by=\"data\") %>% \n  filter(!is.na(pm10))\n\nggplot(pm10_wiatr, aes(x=sila_med, y=pm10, color=kierunek8)) +\n  geom_point() +\n  scale_color_discrete(name = \"Kierunek wiatru\") +\n  xlab(\"Mediana siły wiatru\") +\n  ylab(\"Stężenie PM10\") +\n  ggtitle(\"Zależność pomiędzy stężeniem PM10 i siłą wiatru w latach 2015-2019\")+\n  labs(caption = \"Łukasz Wawrowski - wawrowski.edu.pl\") +\n  theme_light() +\n  theme(legend.position = \"bottom\",\n        plot.caption = element_text(color = \"grey80\")) +\n  guides(col = guide_legend(nrow = 1))\n```\n\n::: {.cell-output-display}\n![](smog-wiatr_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nNa wykresie nie jest widoczna silna współzależność. Współczynnik korelacji liniowej pomiędzy tymi zmiennymi wynosi $r=-0,22$, co oznacza, że pomiędzy siłą wiatru a stężeniem PM10 występuje słaba ujemna zależność. Także w przypadku kierunku wiatru nie można zidentyfikować wzorca zależności. Wysokie stężenie PM10 występuję dla wiatru z kierunku południowo-zachodniego (SW), wschodniego (E), a także północno-wschodniego (NE).\n\nW kolejnym kroku zestawimy indeks jakości powietrza z kierunkiem wiatru.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(pm10_wiatr$indeks, pm10_wiatr$kierunek8) %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n|             |  N| NE|   E| SE|  S|  SW|   W| NW|\n|:------------|--:|--:|---:|--:|--:|---:|---:|--:|\n|bardzo dobry |  1|  9|  11|  1| 11| 133|  90| 28|\n|dobry        |  5| 96| 187| 14| 74| 336| 149| 76|\n|umiarkowany  |  7| 28|  72|  1| 14|  89|  22| 27|\n|dostateczny  |  4| 12|  38|  1|  4|  62|   9|  9|\n|zły          |  3|  5|  27|  0|  3|  30|   4|  3|\n|bardzo zły   |  3|  8|  30|  0|  4|  30|   5|  4|\n:::\n:::\n\n\nNajwięcej dni ze złym i bardzo złym indeksem powietrza występowało razem z wiatrem wschodnim (E) i południwo-zachodnim (SW), co jest związane z faktem, że wiatr z tych kierunków najczęściej występował w Pszczynie. Powyższe dane zestawimy także w postaci względnej.\n\n\n::: {.cell preview='true'}\n\n```{.r .cell-code}\nround_preserve_sum <- function(x, digits = 0) {\n  up <- 10 ^ digits\n  x <- x * up\n  y <- floor(x)\n  indices <- tail(order(x-y), round(sum(x)) - sum(y))\n  y[indices] <- y[indices] + 1\n  y / up\n}\n\npm10_wiatr %>% \n  count(indeks, kierunek8) %>% \n  group_by(indeks) %>% \n  mutate(proc=round_preserve_sum(n/sum(n)*100),\n         proc_label=ifelse(proc > 0, proc, NA)) %>% \n  ggplot(aes(x=indeks, y=proc, fill=kierunek8)) +\n  geom_col() +\n  geom_text(aes(label = proc_label), position = position_stack(0.5)) +\n  scale_fill_discrete(name = \"Kierunek wiatru\") +\n  xlab(\"Indeks jakości powietrza\") +\n  ylab(\"Odsetek dni (w %)\") +\n  coord_flip() +\n  ggtitle(\"Udział kierunku wiatru w ramach indeksu powietrza\") +\n  labs(caption = \"Łukasz Wawrowski - wawrowski.edu.pl\") +\n  theme_light() +\n  theme(legend.position = \"bottom\",\n        plot.caption = element_text(color = \"grey80\")) +\n  guides(fill = guide_legend(nrow = 1))\n```\n\n::: {.cell-output-display}\n![](smog-wiatr_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nNa rysunku można zauważyć, że bez względu na indeks jakości powietrza największy odsetek stanowi wiatr wiejący z południowego-zachodu (SW), a na drugim miejscu jest wiatr wschodni (E). Jedynie w przypadku bardzo dobrego poziomu jakości powietrza na drugim miejscu znajduje się wiatr zachodni (W).\n\nNiniejsza analiza nie pozwala w sposób jednoznaczny powiązać jakości powietrza z kierunkiem wiatru. Być może analiza bardziej szczegółowych danych na temat pyłów pozwoliłaby lepiej zbadać ten wpływ.\n\n\n",
    "supporting": [
      "smog-wiatr_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}